<?xml version="1.0" encoding="UTF-8"?>
<model xmlns="http://www.cellml.org/cellml/1.1#" xmlns:cmeta="http://www.cellml.org/metadata/1.0#"
	xmlns:cellml="http://www.cellml.org/cellml/1.1#" cmeta:id="riceCalciumTransient"
	name="rice_cai">

	<units name="millisecond">
		<unit units="second" prefix="milli" />
	</units>
	<units name="micromolar">
		<unit units="mole" prefix="micro" />
		<unit units="litre" exponent="-1" />
	</units>
    <units name="mV">
      <unit prefix="milli" units="volt"/>
   </units>
    
    <import xlink:href="../Rogers/experiments/multiple-stimulus.xml" xmlns:xlink="http://www.w3.org/1999/xlink">
    	<component name="AP" component_ref="interface"/>
	</import>
    
    <group>
      <relationship_ref relationship="encapsulation"/>
       <component_ref component="interface">
         <component_ref component="AP"/>
      </component_ref>
   </group>
   
	<component name="interface">
        <variable units="mV" name="Vm" private_interface="in" public_interface="out"/>
		<variable name="time" public_interface="in"
			private_interface="out" units="millisecond" />
       <variable name="iteration_time" public_interface="out"
			private_interface="in" units="millisecond" />
		<variable name="tstart" public_interface="in"
			private_interface="out" units="millisecond" />
		<variable name="Tau1" public_interface="in"
			private_interface="out" units="millisecond" />
		<variable name="Tau2" public_interface="in"
			private_interface="out" units="millisecond" />
		<variable name="Cai_amp" public_interface="in"
			private_interface="out" units="micromolar" />
		<variable name="Cai_dias" public_interface="in"
			private_interface="out" units="micromolar" />

		<variable name="Cai" public_interface="out"
			private_interface="in" units="micromolar" />
        <variable name="t" public_interface="out"
			private_interface="in" units="millisecond" />
	</component>
	
	<connection>
		<map_components component_1="interface" component_2="transient"/>
		<map_variables variable_1="time" variable_2="time"/>
        <map_variables variable_1="iteration_time" variable_2="iteration_time"/>
		<map_variables variable_1="tstart" variable_2="tstart"/>
		<map_variables variable_1="Tau1" variable_2="Tau1"/>
		<map_variables variable_1="Tau2" variable_2="Tau2"/>
		<map_variables variable_1="Cai_amp" variable_2="Cai_amp"/>
		<map_variables variable_1="Cai_dias" variable_2="Cai_dias"/>
		<map_variables variable_1="Cai" variable_2="Cai"/>
        <map_variables variable_1="t" variable_2="t"/>
	</connection>

	<component name="transient">
        <variable name="iteration_time" public_interface="out" initial_value="0" units="millisecond" />
		<variable name="time" public_interface="in" units="millisecond" />
		<variable name="tstart" public_interface="in" units="millisecond" />
		<variable name="Tau1" public_interface="in" units="millisecond" />
		<variable name="Tau2" public_interface="in" units="millisecond" />
		<variable name="Cai_amp" public_interface="in" units="micromolar" />
		<variable name="Cai_dias" public_interface="in" units="micromolar" />
		<variable name="Cai" public_interface="out" units="micromolar" />
		<variable name="t" public_interface="out" initial_value="0" units="millisecond" />
		<variable name="beta" units="dimensionless"/>
		<math xmlns="http://www.w3.org/1998/Math/MathML">
			<apply><eq/>
				<ci>beta</ci>
				<apply><minus/>
					<apply><power/>
						<apply><divide/>
							<ci>Tau1</ci>
							<ci>Tau2</ci>
						</apply>
						<apply><divide/>
							<cn cellml:units="dimensionless">-1.0</cn>
							<apply><minus/>
								<apply><divide/>
									<ci>Tau1</ci>
									<ci>Tau2</ci>
								</apply>
								<cn cellml:units="dimensionless">1.0</cn>
							</apply>
						</apply>
					</apply>
					<apply><power/>
						<apply><divide/>
							<ci>Tau1</ci>
							<ci>Tau2</ci>
						</apply>
						<apply><divide/>
							<cn cellml:units="dimensionless">-1.0</cn>
							<apply><minus/>
								<cn cellml:units="dimensionless">1.0</cn>
								<apply><divide/>
									<ci>Tau2</ci>
									<ci>Tau1</ci>
								</apply>
							</apply>
						</apply>
					</apply>
				</apply>
			</apply>
			<!--<apply><eq/>
				<ci>tCai</ci>
				<apply><minus/>
					<ci>t</ci>
					<ci>tstart</ci>
				</apply>
			</apply>  -->
			<apply><eq/>
				<ci>Cai</ci>
				<piecewise>
					<piece>
						<ci>Cai_dias</ci>
						<apply><lt/>
							<ci>iteration_time</ci>
							<ci>tstart</ci>
						</apply>
					</piece>
					<otherwise>
						<apply><plus/>
							<apply><times/>
								<apply><divide/>
									<apply><minus/>
										<ci>Cai_amp</ci>
										<ci>Cai_dias</ci>
									</apply>
									<ci>beta</ci>
								</apply>
								<apply><minus/>
									<apply><exp/>
										<apply><divide/>
											<apply><times/>
												<cn cellml:units="dimensionless">-1.0</cn>
												<ci>t</ci>
											</apply>
											<ci>Tau1</ci>
										</apply>
									</apply>
									<apply><exp/>
										<apply><divide/>
											<apply><times/>
												<cn cellml:units="dimensionless">-1.0</cn>
												<ci>t</ci>
											</apply>
											<ci>Tau2</ci>
										</apply>
									</apply>
								</apply>
							</apply>
							<ci>Cai_dias</ci>
						</apply>
					</otherwise>
				</piecewise>
			</apply>
		</math>
	</component>

	<group>
		<relationship_ref relationship="encapsulation" />
		<component_ref component="interface">
			<component_ref component="transient" />
		</component_ref>
	</group>
    
   <connection>
	  <map_components component_1="AP" component_2="interface"/>
	  <map_variables variable_1="time" variable_2="time"/>
      <map_variables variable_1="Vm" variable_2="Vm"/>
   </connection>
</model>